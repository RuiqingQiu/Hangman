<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href="css/bootstrap.min.css" rel="stylesheet">

        <title>Hangman Demo</title>
    </head>
    <body>
      <nav class="navbar navbar-default" role="navigation">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="#">Hangman Demo</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li class="active"><a href="#">
          <span class="glyphicon glyphicon-home" aria-hidden="true"></span>
          Home
          <span class="sr-only">(current)</span></a>
        </li>
        <li><a href="#">
          <span class="glyphicon glyphicon-picture" aria-hidden="true"></span>
          D-Separation Demo</a>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
            <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
            More<span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu">
            <li><a href="#">Course Homepage</a></li>
            <li><a href="#">Useful links</a></li>
            <li><a href="#">CSE Page</a></li>
            <li class="divider"></li>
            <li><a href="#">Separated link</a></li>
            <li class="divider"></li>
            <li><a href="#">One more separated link</a></li>
          </ul>
        </li>
      </ul>

      <form class="navbar-form navbar-left" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search">
        </div>
        <button type="submit" class="btn btn-default">Submit</button>
      </form>
      <!--
      <ul class="nav navbar-nav navbar-right">
        <li><a href="#">Link</a></li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Dropdown <span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu">
            <li><a href="#">Action</a></li>
            <li><a href="#">Another action</a></li>
            <li><a href="#">Something else here</a></li>
            <li class="divider"></li>
            <li><a href="#">Separated link</a></li>
          </ul>
        </li>
      </ul>-->
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>
      <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
      <!-- Include all compiled plugins (below), or include individual files as needed -->
      <script src="js/bootstrap.min.js"></script>
      <div class="form-group has-success">
        <label class="control-label" for="inputSuccess1">Give a Dictionary file</label>
        <input type="file" class="form_control" id="files" name="files[]" multiple />
        <p class="help-block">Dictionary file contains one word per line</p>
      </div>
        <output id="list"></output>

        <p id="fileContents"></p>
        <button type="button" class="btn btn-primary" onclick="processVocab()">Process</button>
        <hr>
        <div class="row">
          <div class="col-md-4 progress">
            <div id="p_bar" class="progress-bar" role="progressbar progress-bar-striped" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
              0%
            </div>
          </div>
        </div>
        <div id="pick_length">
          <div class="dropdown">
            <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-expanded="true">
              Words Length
              <span class="caret"></span>
            </button>
            <ul id="ul_length" class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1">
              <!--<li role="presentation"><a role="menuitem" tabindex="-1" href="#">Action</a></li>
              <li role="presentation"><a role="menuitem" tabindex="-1" href="#">Another action</a></li>
              <li role="presentation"><a role="menuitem" tabindex="-1" href="#">Something else here</a></li>
              <li role="presentation"><a role="menuitem" tabindex="-1" href="#">Separated link</a></li>-->
            </ul>
          </div>
       </div>


        <!--<table id="length_table">
        </table>-->
        <hr>
        <div class="btn-group" role="group" aria-label="...">
          <button type="button" class="btn btn-default" onClick="guess('A');">A</button>
          <button type="button" class="btn btn-default" onClick="guess('B');">B</button>
          <button type="button" class="btn btn-default" onClick="guess('C');">C</button>
          <button type="button" class="btn btn-default" onClick="guess('D');">D</button>
          <button type="button" class="btn btn-default" onClick="guess('E');">E</button>
          <button type="button" class="btn btn-default" onClick="guess('F');">F</button>
          <button type="button" class="btn btn-default" onClick="guess('G');">G</button>
          <button type="button" class="btn btn-default" onClick="guess('H');">H</button>
          <button type="button" class="btn btn-default" onClick="guess('I');">I</button>
          <button type="button" class="btn btn-default" onClick="guess('J');">J</button>
          <button type="button" class="btn btn-default" onClick="guess('K');">K</button>
          <button type="button" class="btn btn-default" onClick="guess('L');">L</button>
          <button type="button" class="btn btn-default" onClick="guess('M');">M</button><br/>
          <button type="button" class="btn btn-default" onClick="guess('N');">N</button>
          <button type="button" class="btn btn-default" onClick="guess('O');">O</button>
          <button type="button" class="btn btn-default" onClick="guess('P');">P</button>
          <button type="button" class="btn btn-default" onClick="guess('Q');">Q</button>
          <button type="button" class="btn btn-default" onClick="guess('R');">R</button>
          <button type="button" class="btn btn-default" onClick="guess('S');">S</button>
          <button type="button" class="btn btn-default" onClick="guess('T');">T</button>
          <button type="button" class="btn btn-default" onClick="guess('U');">U</button>
          <button type="button" class="btn btn-default" onClick="guess('V');">V</button>
          <button type="button" class="btn btn-default" onClick="guess('W');">W</button>
          <button type="button" class="btn btn-default" onClick="guess('X');">X</button>
          <button type="button" class="btn btn-default" onClick="guess('Y');">Y</button>
          <button type="button" class="btn btn-default" onClick="guess('Z');">Z</button>
        </div>
        <!--this paragraph is for keeping track of word -->
        <p id="guessing" style="font-size: 25px"></p>

        <p id="progress"></p>
        <div class="row">
          <div id="container" class="col-md-4" style="width:50%; height:400px;"></div>
          <div id="container2" class="col-md-4" style="width:50%; height:400px;"></div>
        </div>
        <p id="probability"></p>
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
        <script src="http://code.highcharts.com/highcharts.js"></script>
        <script>
        
          //Global variable for keeping all the vocabs.
          var vocab = [];
          var char_frequency = [];
          var word_length = 0;
          //Variable to store all the words that have the length and should be something to guessed
          var guess_pool = [];
          //The word being guessed
          var guessing_word;
          //Tmp user interface for displaying the guessing progress
          var tmp_result = "";

          //Keep track of the corrent index we have now so far
          var correct_index = [];

          //Keep track of the letter we have guessed wrong on
          var list_of_incorrect_guess = [];
          //Keep track of the letter we have guessed correctly
          var list_of_correct_guess = [];

          var letter_corrects = [];

          function handleFileSelect(evt) {
            var files = evt.target.files; // FileList object
            // files is a FileList of File objects. List some properties.
            var output = [];
            for (var i = 0, f; f = files[i]; i++) {
              output.push('<li><strong>', escape(f.name), '</strong> (', f.type || 'n/a', ') - ',
                          f.size, ' bytes, last modified: ',
                          f.lastModifiedDate ? f.lastModifiedDate.toLocaleDateString() : 'n/a',
                          '</li>');
                var reader = new FileReader();
                reader.onload = function(evt){
                    var words = evt.target.result;
                    vocab = words.split("\n");
                }
                // Read in the image file as a data URL.
                reader.readAsText(f);
            }
            document.getElementById('list').innerHTML = '<ul>' + output.join('') + '</ul>';
          }
          document.getElementById('files').addEventListener('change', handleFileSelect, false);

          function processVocab(){
            /*
            //Init char frequency list
            for(var i = 0; i < 26; i++){
                char_frequency[i] = 0;
            }

            for(var i = 0; i < vocab.length; i++){
                var word = vocab[i];
                for(var j = 0; j < word.length; j++){
                    char_frequency[word.charCodeAt(j)-65] += 1; 
                    //console.log(word.charCodeAt(j));
               }
            }
            for(var i = 0; i < 26; i++){
                console.log(String.fromCharCode(i + 65) + ": " +char_frequency[i]);
            }*/

            console.log(vocab);
            vocab.sort(function(a, b){
              return a.length - b.length; // ASC -> a - b; DESC -> b - a
            });
            console.log(vocab);
            var index = 0;
            for(var i = 0; i < vocab.length; i++){
              document.getElementById("p_bar").style.width= (i+1)*100.0/vocab.length + "%";
              document.getElementById("p_bar").innerHTML = (i+1)*100.0/vocab.length + "%";
              var last_index = index;
              console.log(vocab[i].length + vocab[i]);
              if(index < vocab[i].length){
                index = vocab[i].length;
              }
              if(index != last_index){
                //document.getElementById("length_table").innerHTML += "<tr>\n<td>words length " + index + "<input id=\"length1\" type=\"radio\" name=\"length\" value = \"" + index + "\" onclick=\"setVocabLength(" + index + ")\"></td>\n</tr>";
                document.getElementById("ul_length").innerHTML += "<li role=\"presentation\"><a role=\"menuitem\" tabindex=\"-1\" value = \"" + index + "\" onclick=\"setVocabLength(" + index + ")\">Words of Length " + index + "</a></li>";
              }
            }
          }
          function setVocabLength(selected_length){
            guess_pool = [];
            word_length = selected_length;
            //If file read in happened
            if(vocab.length != 0){
              for(var i = 0; i < vocab.length; i++){
                if(vocab[i].length == word_length){
                  guess_pool.push(vocab[i]);
                }
              }
              var index = Math.floor((Math.random() * guess_pool.length));

              guessing_word = guess_pool[index];
              console.log("the guess word pool is");
              console.log(guess_pool);
              console.log("the word is " + guessing_word);
              tmp_result = "";
              correct_index = [];
              list_of_incorrect_guess = [];
              for(var i = 0; i < guessing_word.length; i++){
                console.log(guessing_word.charAt(i));
                tmp_result += "_ ";
              }
              document.getElementById("guessing").innerHTML = tmp_result + "<br/>";
              document.getElementById("progress").innerHTML = "";
              document.getElementById("probability").innerHTML = "";
            }
            else{
              alert("need to read a vocab file");
            }
          }
          $(function () {
              $(document).ready(function () {
                // Build the chart
                $('#container2').highcharts({
                  chart: {
                    plotBackgroundColor: null,
                    plotBorderWidth: null,
                    plotShadow: false
                  },
                  title: {
                    text: 'Letter Probability Distribution'
                  },
                  tooltip: {
                    pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
                  },
                  plotOptions: {
                    pie: {
                      allowPointSelect: true,
                      cursor: 'pointer',
                      dataLabels: {
                        enabled: false
                        },
                      showInLegend: true
                    }
                  },
                  series: [{
                    type: 'pie',
                    name: 'next guess probability',
                    data: []
                  }]
                });
              });
          });

            $(function () {
              $(document).ready(function () {
                // Build the chart
                $('#container').highcharts({
                  chart: {
                    plotBackgroundColor: null,
                    plotBorderWidth: null,
                    plotShadow: false
                  },
                  title: {
                    text: 'Words Probability Distribution'
                  },
                  tooltip: {
                    pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
                  },
                  plotOptions: {
                    pie: {
                      allowPointSelect: true,
                      cursor: 'pointer',
                      dataLabels: {
                        enabled: false
                        },
                      showInLegend: true
                    }
                  },
                  series: [{
                    type: 'pie',
                    name: 'next guess probability',
                    data: []
                  }]
                });
              });
          });

          /**
           * Function called when the letter keyboard is pressed and one 
           * letter is being guessed.
           **/
          function guess(letter){

            if(word_length == 0){
              alert("pick the word length");
            }
            else{
              document.getElementById("progress").innerHTML += "guessing letter " + letter + "<br/>";
            }
            tmp_result = "";
            console.log(letter);
            var index = indexes(guessing_word, "" + letter);
            console.log(index);
            //Check if the letter happen to be in the word we are guessing
            if(index.length > 0){
              console.log("correct guessed");
              for(var i = 0; i < index.length; i++){
                correct_index.push(index[i]);
              }
              var tmp_index = 0;
              correct_index = correct_index.filter(onlyUnique);
              //Sort can't use the default string comparsion, need to provide a parameter value
              correct_index.sort(function(a, b){return a-b});
              console.log(correct_index);
              console.log("length is " + guessing_word.length);
              for(var i = 0; i < guessing_word.length; i++){
                if(tmp_index >= correct_index.length){
                  tmp_result += "_ ";
                }
                else{
                  if(i == correct_index[tmp_index]){
                    console.log("correct guessed letter " + letter + " at index " + i);
                    tmp_result += "" + guessing_word.charAt(i) + " ";
                    tmp_index++;
                  }
                  else{
                    tmp_result += "_ ";
                  }
                }
              }
              //Output the current result
              document.getElementById("guessing").innerHTML = tmp_result + "<br/>";
              //If it's done then output DONE
              if(correct_index.length == guessing_word.length){
                document.getElementById("progress").innerHTML += "DONE!" + "<br/>";
              }
              var tuple = {letter: letter, length: index.length};
              list_of_correct_guess.filter(onlyUnique);
              letter_corrects.push(letter);
            }
            else{
              console.log("wrong");
              list_of_incorrect_guess.push(letter);
              list_of_incorrect_guess.filter(onlyUnique);
              //console.log("list of incorret guess:");
              //console.log(list_of_incorrect_guess);
            }
            document.getElementById("probability").innerHTML = "Best Guess: <br/>";
            list_of_possible_guess = [];
            
            //If it was not a correct guess
            if(correct_index.length == 0){
              console.log("enter correct index ==0");
              console.log(list_of_incorrect_guess);
              for(var i = 0; i < guess_pool.length; i++){
                var never_appear = true;
                for(var k = 0; k < list_of_incorrect_guess.length; k++){
                  var current_word = guess_pool[i];
                  if(current_word.indexOf(list_of_incorrect_guess[k]) === -1){
                  }
                  else{
                    never_appear = false;
                    break;
                  }
                }
                if(never_appear){
                  list_of_possible_guess.push(guess_pool[i]);
                }
                never_appear = false;

              }
            }
            //This for loop is for finding the possible words in the guess pool
            for(var i = 0; i < guess_pool.length; i++){
              var current_word = guess_pool[i];
              var good = false;
              for(var j = 0; j < correct_index.length; j++){
                //console.log(guessing_word.charAt(correct_index[j]));
                //console.log(current_word.charAt(correct_index[j]));
                if(guessing_word.charAt(correct_index[j]) == current_word.charAt(correct_index[j])){
                  console.log("here");
                }
                else{
                  good = false;
                  break;
                }
                good = true;
              }
              //If the vocab satisfy our correct index result
              if(good){
                //We do a second check here to see if the wrong guessed letter have appear in such word
                if(list_of_incorrect_guess.length == 0){
                  //console.log("pushing" + current_word);
                  list_of_possible_guess.push(current_word);
                  //console.log("list size" + list_of_possible_guess.length);
                }
                else{
                  var never_appear = true;
                  for(var k = 0; k < list_of_incorrect_guess.length; k++){
                    if(current_word.indexOf(list_of_incorrect_guess[k]) === -1){ 
                    }
                    else{
                      never_appear = false;
                      break;
                    }
                  }
                  if(never_appear){

                    //Check it doesn't contain duplicates
                    if(list_of_possible_guess.indexOf(current_word) === -1){
                      var have_correct_number_of_letter = true;
                      //Third check, having the same amount of correct guessed letter
                      for(var l = 0; l < list_of_correct_guess.length; l++){
                        if(current_word.split(new RegExp(list_of_correct_guess[l].letter, "gi").length-1) != list_of_correct_guess[l].length){
                          have_correct_number_of_letter = false;
                          break;
                        }
                      }
                      if(have_correct_number_of_letter){
                        list_of_possible_guess.push(current_word);
                      }
                    }
                  }
                }
              }
            }
            //console.log("list of possible guess");
            console.log(list_of_possible_guess);
            list_of_prob = []
            for(var i = 0; i < list_of_possible_guess.length; i++){
              //prob for P(W = word)
              var prob = 1/list_of_possible_guess.length;
              list_of_prob.push([list_of_possible_guess[i], prob]);
              //document.getElementById("probability").innerHTML += list_of_possible_guess[i] + " with probability " + prob +  "<br/>";
            }

            char_frequency = [];
            for (var i = 0; i < 26; i++){
              char_frequency[i] = 0;
            }
            total = 0.0
            for(var i = 0; i < list_of_possible_guess.length;i++){
              var word = list_of_possible_guess[i];
              for(var j = 0; j < word.length; j++){
                    char_frequency[word.charCodeAt(j)-65] += 1; 
                    total += 1.0
                    //console.log(word.charCodeAt(j));
               }
            }
            pie_chart_data = [];
            console.log("entered");

            console.log(letter_corrects)
            for(var i = 0; i < 26; i++){
              if(letter_corrects.indexOf(String.fromCharCode(65 + i)) === -1){
                pie_chart_data.push(char_frequency[i]/total);

              }
              else{
                pie_chart_data.push(0);


              }
            }
            bar_char_y = [];
            for(var i = 0; i < 26; i++){
              bar_char_y[i] = String.fromCharCode(65 + i);
            }

             $(function () { 
              $('#container2').highcharts({
                chart: {
                  type: 'column'
                },
                title: {
                  text: 'Letter Probability Distribution'
                },
                xAxis: {
                  categories: bar_char_y
                },
                yAxis: {
                  title: {
                    text: 'Probability'
                  }
                },
                plotOptions: {
                  column: {
                    pointPadding: 0,
                    borderWidth: 1,
                    groupPadding: 0,
                    shadow: true
                  }
                },
                series: [
                  {
                    data: pie_chart_data
                  }]
                });
            });
             /*
            $(function () {
              $(document).ready(function () {
                // Build the chart
                $('#container2').highcharts({
                  chart: {
                    plotBackgroundColor: null,
                    plotBorderWidth: null,
                    plotShadow: false
                  },
                  title: {
                    text: 'Letter Probability Distribution'
                  },
                  tooltip: {
                    pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
                  },
                  plotOptions: {
                    pie: {
                      allowPointSelect: true,
                      cursor: 'pointer',
                      dataLabels: {
                        enabled: false
                        },
                      showInLegend: true
                    }
                  },
                  series: [{
                    type: 'pie',
                    name: 'next guess probability',
                    data: pie_chart_data
                  }]
                });
              });
          });*/

            $(function () {
              $(document).ready(function () {
                // Build the chart
                $('#container').highcharts({
                  chart: {
                    plotBackgroundColor: null,
                    plotBorderWidth: null,
                    plotShadow: false
                  },
                  title: {
                    text: 'Words Probability Distribution'
                  },
                  tooltip: {
                    pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
                  },
                  plotOptions: {
                    pie: {
                      allowPointSelect: true,
                      cursor: 'pointer',
                      dataLabels: {
                        enabled: false
                        },
                      showInLegend: true
                    }
                  },
                  series: [{
                    type: 'pie',
                    name: 'next guess probability',
                    data: list_of_prob
                  }]
                });
              });
          });

            /*
            $(function () { 
              $('#container').highcharts({
                chart: {
                  type: 'column'
                },
                title: {
                  text: 'Probability Distribution'
                },
                xAxis: {
                  categories: list_of_possible_guess
                },
                yAxis: {
                  title: {
                    text: 'Probability'
                  }
                },
                plotOptions: {
                  column: {
                    pointPadding: 0,
                    borderWidth: 1,
                    groupPadding: 0,
                    shadow: true
                  }
                },
                series: [
                  {
                    data: list_of_prob
                  }]
                });
            });
            */
          }
          /**
           * Given a string and its find, return all indexs of its occurences
           **/
          function indexes(source, find) {
            var result = [];
            for(i=0;i<source.length; ++i) {
            // If you want to search case insensitive use 
            // if (source.substring(i, i + find.length).toLowerCase() == find) {
              if (source.substring(i, i + find.length) == find) {
                result.push(i);
              }
             }
            return result;
          }
          function onlyUnique(value, index, self) { 
            return self.indexOf(value) === index;
          }

          //TODO, eliminte words that have multiple letter S
        </script>
    </body>
</html>
